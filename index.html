<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ•è³‡ä¿å–®èˆ‡ ETF è³ªæŠ¼ - ç½é›£æ¨¡æ“¬å™¨</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-main: #2c3e50;
            --success: #389e0d;
            --warning: #faad14;
            --danger: #cf1322;
            --primary: #1890ff;
        }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg-color); color: var(--text-main); padding: 20px; margin: 0; }
        .container { max-width: 1100px; margin: 0 auto; }

        /* æ§åˆ¶å€æ¨£å¼ */
        .control-box {
            background: var(--card-bg); padding: 25px; border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 25px;
            position: sticky; top: 10px; z-index: 100; border: 1px solid #e8e8e8;
        }
        .slider-container { position: relative; margin: 30px 10px 10px 10px; }
        input[type=range] {
            width: 100%; -webkit-appearance: none; background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 24px; width: 24px; border-radius: 50%;
            background: var(--danger); cursor: pointer; margin-top: -10px; box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 6px; cursor: pointer; background: #ddd; border-radius: 3px;
        }
        
        /* æ­·å²æ¨™è¨˜ */
        .markers { position: relative; height: 20px; margin-top: 5px; font-size: 12px; color: #888; }
        .marker { position: absolute; transform: translateX(-50%); text-align: center; white-space: nowrap; }
        .marker::before { content: '|'; display: block; font-weight: bold; margin-bottom: 2px; }

        .dashboard-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 15px; }
        .market-status { font-size: 1.5em; font-weight: bold; color: var(--danger); }
        .status-desc { font-size: 0.9em; color: #666; margin-top: 5px; }

        /* å¡ç‰‡å€åŸŸ */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
        
        .card {
            background: var(--card-bg); border-radius: 10px; padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-top: 4px solid var(--success);
            transition: transform 0.2s;
        }
        .card:hover { transform: translateY(-2px); }
        .card.safe { border-top-color: var(--success); }
        .card.warn { border-top-color: var(--warning); background: #fffbe6; }
        .card.danger { border-top-color: var(--danger); background: #fff1f0; }

        .card-header { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .card-title { font-weight: bold; font-size: 1.1em; }
        .badge { padding: 2px 8px; border-radius: 4px; font-size: 0.8em; color: white; }
        .badge.safe { background: var(--success); }
        .badge.warn { background: var(--warning); }
        .badge.danger { background: var(--danger); }

        .row { display: flex; justify-content: space-between; margin: 5px 0; font-size: 0.9em; }
        .val-num { font-weight: bold; font-family: Consolas, monospace; }
        .highlight-red { color: var(--danger); }
        
        /* é€²åº¦æ¢ */
        .progress-wrapper { margin-top: 10px; }
        .progress-label { display: flex; justify-content: space-between; font-size: 0.8em; color: #666; margin-bottom: 2px; }
        .progress-bg { height: 8px; background: #eee; border-radius: 4px; overflow: hidden; }
        .progress-bar { height: 100%; transition: width 0.3s ease, background 0.3s ease; }

    </style>
</head>
<body>

<div class="container">
    <div class="control-box">
        <div class="dashboard-header">
            <div>
                <h2 style="margin:0;">è‚¡å¸‚ç½é›£æ¨¡æ“¬å™¨</h2>
                <div class="status-desc">ä½ çš„é…ç½®ï¼šå¹³è¡¡å‹ä¿å–® (Beta 0.6) | ETF 5:4:1 çµ„åˆ (Beta 0.55)</div>
            </div>
            <div style="text-align: right;">
                <div>å¤§ç›¤è·Œå¹…: <span id="marketDropDisplay" class="market-status">0%</span></div>
                <div style="font-size:12px; color:#666;">ä½ çš„è³‡ç”¢å¹³å‡è·Œå¹…: <span id="myDropDisplay">0%</span></div>
            </div>
        </div>

        <div class="slider-container">
            <input type="range" id="crashSlider" min="0" max="60" value="0" step="1" oninput="updateSimulation()">
            <div class="markers">
                <div class="marker" style="left: 0%">å¹³ç›¤</div>
                <div class="marker" style="left: 10%">ä¿®æ­£</div>
                <div class="marker" style="left: 20%">ç†Šå¸‚</div>
                <div class="marker" style="left: 30%">COVID</div>
                <div class="marker" style="left: 50%">2008æµ·å˜¯</div>
                <div class="marker" style="left: 60%">ä¸–ç•Œæœ«æ—¥</div>
            </div>
        </div>
        <div style="text-align: center; margin-top: 15px; font-size: 14px; color: #555; background: #f9f9f9; padding: 10px; border-radius: 6px;">
            <span id="scenarioText">ç›®å‰å¸‚å ´é¢¨å¹³æµªéœï¼Œè³‡ç”¢åƒ¹å€¼ç©©å®šã€‚</span>
        </div>
    </div>

    <div class="grid" id="cardGrid">
        <!-- å¡ç‰‡å°‡ç”± JS ç”Ÿæˆ -->
    </div>
</div>

<script>
    // ä½ çš„è³‡ç”¢æ•¸æ“š
    // type: 1=å¹³è¡¡ä¿å–®, 2=å„²è“„éšª, 3=ETF
    // limit1: è­¦å‘Šç·š (ä¿å–®æ˜¯LTV 80%, ETFæ˜¯ç¶­æŒç‡ 130%)
    // limit2: æ–·é ­ç·š (ä¿å–®æ˜¯LTV 90%, ETFæ˜¯ç¶­æŒç‡ 115%)
    const assets = [
        { id: 'A', name: 'ä¿å–® A (æ³•å·´å¹´é‡‘)', type: 1, val: 47.7, loan: 21.5, limit1: 80, limit2: 90 },
        { id: 'B', name: 'ä¿å–® B (æ³•å·´å£½éšª)', type: 1, val: 147.8, loan: 68.5, limit1: 80, limit2: 90 },
        { id: 'C', name: 'ä¿å–® C (å®‰é”å¹´é‡‘)', type: 1, val: 180, loan: 84, limit1: 80, limit2: 90 },
        { id: 'D', name: 'ä¿å–® D (å®‰è¯ä¸»åŠ›)', type: 1, val: 328, loan: 90, limit1: 60, limit2: 70 }, // å‡è¨­è¼ƒåš´æ ¼
        { id: 'E', name: 'ä¿å–® E (é é›„äººå£½)', type: 2, val: 15, loan: 8, limit1: 95, limit2: 100 },
        { id: 'ETF', name: 'å°è‚¡ ETF çµ„åˆ (è³ªæŠ¼)', type: 3, val: 171, loan: 34.5, limit1: 130, limit2: 115 }
    ];

    function updateSimulation() {
        const sliderVal = document.getElementById('crashSlider').value;
        const marketDropPct = parseInt(sliderVal);
        
        // æ›´æ–°é¡¯ç¤ºæ–‡å­—
        document.getElementById('marketDropDisplay').innerText = `-${marketDropPct}%`;
        
        // èªªæ˜æ–‡å­—é‚è¼¯
        let scenario = "";
        if(marketDropPct < 5) scenario = "å¸‚å ´æ³¢å‹•æ­£å¸¸ï¼Œç„¡éœ€æ“”å¿ƒã€‚";
        else if(marketDropPct < 15) scenario = "å¸‚å ´é€²å…¥ä¿®æ­£æœŸï¼Œä½ çš„å¹³è¡¡é…ç½®é–‹å§‹ç™¼æ®æŠ—è·Œä½œç”¨ã€‚";
        else if(marketDropPct < 25) scenario = "æŠ€è¡“æ€§ç†Šå¸‚ï¼ç´”è‚¡ç¥¨æŠ•è³‡äººé–‹å§‹ææ…Œï¼Œä½†ä½ çš„å‚µåˆ¸éƒ¨ä½æä¾›äº†ç·©è¡ã€‚";
        else if(marketDropPct < 35) scenario = "é¡ä¼¼ 2020 æ–°å† ç–«æƒ…çˆ†ç™¼ã€‚ä½ çš„è³‡ç”¢ç¸®æ°´ï¼Œä½†è·é›¢æ–·é ­ä»éå¸¸é™é ã€‚";
        else if(marketDropPct < 55) scenario = "é¡ä¼¼ 2008 é‡‘èæµ·å˜¯ã€‚é€™æ˜¯æ¥µç«¯å£“åŠ›æ¸¬è©¦ï¼Œæª¢è¦–å®‰å…¨é‚Šéš›çš„æ™‚åˆ»ã€‚";
        else scenario = "æ¯€æ»…æ€§è‚¡ç½ã€‚è‹¥ç™¼ç”Ÿæ­¤æƒ…æ³ï¼Œç¾é‡‘èˆ‡é»ƒé‡‘æ‰æ˜¯ç‹é“ï¼Œä½†ä½ çš„ä½æ§“æ¡¿æ•‘äº†ä½ ã€‚";
        document.getElementById('scenarioText').innerText = scenario;

        const grid = document.getElementById('cardGrid');
        grid.innerHTML = ''; // æ¸…ç©º

        let totalDropWeighted = 0;
        let assetCount = 0;

        assets.forEach(item => {
            // è¨ˆç®—å€‹åˆ¥è³‡ç”¢è·Œå¹…
            // å¹³è¡¡å‹ Beta 0.6, ETF Beta 0.55 (å«å‚µ), å„²è“„éšª Beta 0
            let beta = 0;
            if (item.type === 1) beta = 0.6;
            else if (item.type === 3) beta = 0.55;
            
            const itemDropPct = marketDropPct * beta;
            const currentVal = item.val * (1 - (itemDropPct / 100));
            
            // è¨ˆç®—çµ±è¨ˆç”¨
            if(item.type !== 2) {
                totalDropWeighted += itemDropPct;
                assetCount++;
            }

            // è¨ˆç®—é¢¨éšªæŒ‡æ¨™
            let riskVal = 0; // LTV æˆ– ç¶­æŒç‡
            let status = 'safe';
            let statusText = 'å®‰å…¨';
            let barColor = 'var(--success)';
            let barWidth = 0;
            let displayRisk = '';
            let detailHtml = '';

            if (item.type === 1 || item.type === 2) {
                // ä¿å–®ï¼šçœ‹ LTV (å€Ÿæ¬¾ / ç¾å€¼)
                riskVal = (item.loan / currentVal) * 100;
                displayRisk = `å€Ÿæ¬¾æ¯”: ${riskVal.toFixed(1)}%`;
                
                // åˆ¤æ–·ç‹€æ…‹
                if (riskVal >= item.limit2) {
                    status = 'danger'; statusText = 'æ–·é ­é¢¨éšª'; barColor = 'var(--danger)';
                    detailHtml = `âš ï¸ ç¾å€¼ä½æ–¼ ${(item.loan / (item.limit2/100)).toFixed(1)}è¬`;
                } else if (riskVal >= item.limit1) {
                    status = 'warn'; statusText = 'éœ€è£œç¹³'; barColor = 'var(--warning)';
                    detailHtml = `âš ï¸ æ¥è¿‘è£œç¹³é–€æª»`;
                }
                barWidth = Math.min(riskVal, 100);

            } else {
                // ETFï¼šçœ‹ ç¶­æŒç‡ (ç¾å€¼ / å€Ÿæ¬¾)
                riskVal = (currentVal / item.loan) * 100;
                displayRisk = `ç¶­æŒç‡: ${riskVal.toFixed(0)}%`;
                
                // åˆ¤æ–·ç‹€æ…‹ (ç¶­æŒç‡è¶Šä½è¶Šå±éšª)
                if (riskVal <= item.limit2) {
                    status = 'danger'; statusText = 'æ–·é ­å‡ºå ´'; barColor = 'var(--danger)';
                    detailHtml = `ğŸ’€ ä½æ–¼ ${item.limit2}% å¼·åˆ¶è³£å‡º`;
                } else if (riskVal <= item.limit1) {
                    status = 'warn'; statusText = 'è¿½ç¹³ä¿è­‰é‡‘'; barColor = 'var(--warning)';
                    detailHtml = `âš ï¸ ä½æ–¼ ${item.limit1}% éœ€è£œéŒ¢`;
                }
                // é€²åº¦æ¢è¦–è¦ºåŒ– (è®“æ»¿æ¢ä»£è¡¨å±éšªï¼Œæ‰€ä»¥åè½‰ä¸€ä¸‹è¦–è¦º)
                // å‡è¨­ 130% æ˜¯è­¦æˆ’(é»ƒ)ï¼Œ115%æ˜¯å±éšª(ç´…)ï¼Œ300%ä»¥ä¸Šæ˜¯ç¶ 
                // é€™è£¡ç‚ºäº†ç°¡å–®ï¼Œæˆ‘å€‘ç•« "å®‰å…¨åº¦"ï¼Œè¶Šé•·è¶Šå®‰å…¨
                 barWidth = Math.min((riskVal / 300) * 100, 100);
            }

            // æ¸²æŸ“å¡ç‰‡
            const html = `
            <div class="card ${status}">
                <div class="card-header">
                    <span class="card-title">${item.name}</span>
                    <span class="badge ${status}">${statusText}</span>
                </div>
                <div class="row">
                    <span>åŸå§‹ç¾å€¼</span>
                    <span>${item.val} è¬</span>
                </div>
                <div class="row">
                    <span>æ¨¡æ“¬ç¾å€¼ <span style="font-size:0.8em; color:#999">(-${itemDropPct.toFixed(1)}%)</span></span>
                    <span class="val-num ${status === 'safe' ? '' : 'highlight-red'}">${currentVal.toFixed(1)} è¬</span>
                </div>
                <div class="row">
                    <span>å€Ÿæ¬¾é‡‘é¡</span>
                    <span>${item.loan} è¬</span>
                </div>
                
                <div class="progress-wrapper">
                    <div class="progress-label">
                        <span>${displayRisk}</span>
                        <span style="color:${status==='safe'?'#999':'red'}">${detailHtml}</span>
                    </div>
                    <div class="progress-bg">
                        <div class="progress-bar" style="width: ${barWidth}%; background: ${barColor};"></div>
                    </div>
                    ${item.type === 3 ? '<div style="font-size:10px; text-align:right; margin-top:2px; color:#aaa">ç¶­æŒç‡è¶Šé«˜è¶Šå®‰å…¨</div>' : '<div style="font-size:10px; text-align:right; margin-top:2px; color:#aaa">å€Ÿæ¬¾æ¯”è¶Šä½è¶Šå®‰å…¨</div>'}
                </div>
            </div>
            `;
            grid.innerHTML += html;
        });
        
        if(assetCount > 0) {
            document.getElementById('myDropDisplay').innerText = `-${(totalDropWeighted/assetCount).toFixed(1)}%`;
        }
    }

    // åˆå§‹åŒ–
    updateSimulation();
</script>

</body>
</html>
